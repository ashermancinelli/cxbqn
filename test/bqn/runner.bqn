
defaultSuites â† {
  d â† "suites/always/"
  always â† dâŠ¸âˆ¾Â¨â€¢file.List d

  hascuda â† +Â´âŸ¨"CXBQN_CUDA"âŸ©âŠ¸â·âŠ‘Â¨â€¢cxbqn.config

  d â†© "suites/cuda/"
  cuda â† dâŠ¸âˆ¾Â¨â€¢file.List d

  alwaysâˆ¾(hascudaâŠ‘âŸ¨âŸ©â€¿cuda)
}

# If args are passed to the runner, use that to determine what suites to run.
# Otherwise, try to discover all available test suites
suitesâ†(Ã—â‰ â€¢args)âŠ‘defaultSuitesâ€¿â€¢args

â€¢Out "Suites: "
â€¢Show suites

# Index of test
iâ†0

# Number of failures
fâ†0

# Failure string to be printed at the end of the test run in case of failures
fsâ†""

# Run a single test suite.
# This would use headers if CXBQN supported them.
T â† {
  iâ†©i+1
  â€¢Show ğ•©
  aâ€¿ttâ†ğ•©
  câ†aâ‰¡râ†â€¢BQN tt
  fâ†©f+Â¬c
  fsâ†©fsâˆ¾câŠ‘âŸ¨(10+@)âˆ¾"test '"âˆ¾ttâˆ¾"' failed: expected: '"âˆ¾(â€¢Fmt a)âˆ¾"', got: '"âˆ¾(â€¢Fmt r)âˆ¾"'", ""âŸ©
  f
}

# Run all test cases in each test suite
{ â€¢Out (10+@)âˆ¾"Running suite "âˆ¾ğ•©â‹„T Â¨ â€¢Import ğ•©} Â¨ suites

â€¢Out ""

â€¢Out (Ã—f)âŠ‘âŸ¨
  "All tests passed."
  "Got "âˆ¾(â€¢Fmt f)âˆ¾" failures:"âˆ¾fs
âŸ©
